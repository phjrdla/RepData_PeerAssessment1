---
title: "Reproducible Research: Peer Assessment 1"
author: "phjrdla"
date: "4 November 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Libraries required
```{r libraries}
library(ggplot2)
library(lubridate)
```

# Data is loaded 
```{r dataload}
## csv file must be in working directory
rawdf <- read.csv('activity.csv', stringsAsFactors =F)
```
# Histogram of the total number of steps per day
## Preparing data
```{r prep1}
## locate rows with NA values for steps
na_rows <- is.na(rawdf$steps)

## keep usable data
df <- rawdf[!na_rows,]

## convert string date field "date" to R date
df$day <- ymd(df$date)

## number of steps per day
steps_d <- aggregate(steps~day, data=df, sum)
```

## Histogram is plotted
```{r plot1}
g <- ggplot(data=steps_d, aes(steps_d$steps)) 
g <- g + geom_histogram(binwidth=500)
g + labs(title = "Histogram of the total number of steps per day"
         ,x="Steps per day", y="Count")
```

# mean and median for number of steps per day
```{r summary}
summary(steps_d$steps)
```
# Time series plot of the average number of steps taken 
```{r prep2}
## aggregate steps on day and compute mean
steps_dm <- aggregate(steps~day, data=df, mean)
```
## Time series plot of the average number of steps taken
```{r plot2}
g <- ggplot(data=steps_dm, aes(x=day, y=steps)) 
g <- g + geom_line(size=2)
g + labs(title = "Time series plot of the average number of steps taken"
         ,x="day", y="Average count")
```

# The 5 minute interval that contains the maximum number of steps
```{r prep3}
## aggregate steps on interval and compute mean
steps_im <- aggregate(steps~interval, data=df, mean)

## index at which max value for steps is found
i_max <- match(max(steps_im$steps),steps_im$steps )
```

```{r max}
## interval containing the maximum number of steps
steps_im$interval[i_max]
```

# Code to describe and show a strategy for imputing missing data
```{r prep4}
## missing steps values for intervals are replaced by 
## interval average values calculated earlier

## locate rows with na values
df_na <- rawdf[na_rows,]

## join (merge) data frames df_na and steps_im calculated earlier
names(df_na)
names(steps_im)
df_joined <- merge(df_na[,c(2,3)],steps_im, by="interval" )
names(df_joined)
## convert string date field "date" to R date
df_joined$day <- ymd(df_joined$date)

## df_joined is appended to df

### as names(df) order is different from names(df_joined)
cols<- intersect( names(df), names(df_joined) )

## rows with average values are now appended
df <- rbind(df[, cols], df_joined[,cols])

## aggregate steps on day
steps_d_filled <- aggregate(steps~day, data=df, sum)
```
# Histogram of the total number of steps per day after missing values are imputed
```{r plot3}
g <- ggplot(data=steps_d_filled, aes(steps_d_filled$steps)) 
g <- g + geom_histogram(binwidth=500)
g + labs(title = "Histogram of the total number of steps per day, with imputed values"
         ,x="Steps per day", y="Average count")
```

# Panel plot comparing the average number of steps taken per 5-minute interval across weekdays and weekends

```{r prep5}
# computes numeric day of week (Sunday is 1)
df$wday <- wday(df$day)

# create a mapping day to type of day
day2dtype <- data.frame( wday=sort(unique(df$wday))
                        ,dtype=c( "WEEKEND","WEEKDAY","WEEKDAY","WEEKDAY"
                                ,"WEEKDAY","WEEKDAY","WEEKEND"))
day2dtype

# join df with mapping
names(df)
names(day2dtype)
df_merged <- merge(df,day2dtype, by="wday")
names(df_merged)

## average number of steps per 5 minutes interval and day type
steps_idm <- aggregate(steps~interval+dtype, data=df_merged, mean)
```

## Time series plots of the average number of steps taken per interval
```{r plot4}
g <- ggplot(steps_idm, aes(x=interval, y=steps)) 
g <- g + geom_line(size=2) + facet_wrap(~dtype, ncol=1)
g + labs(title = "Average number of steps taken per 5 minutes interval across week days and weekends"
         ,x="Interval", y="Average count")
```





